<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!--
   INDRA/CAR/sic3
   $Id: contenido_calificacion_participantes_seleccionar.xml,v 1.1 2009/12/03 18:44:45 pecbazalar Exp $
   BEL

   DRUIDATARGET=/install/cvsiniciales
-->

<!DOCTYPE PAGINA SYSTEM "dtd/druida_3_0.dtd">

<PAGINA nombre="contenido_calificacion_participantes_seleccionar" cod="0491" titulo="Crear concurso" estilos="estilosB3.css" colorf="#F0F0F0" msgle="" onload="onLoadPag();" xml:lang="es" >
        
<JS src="sicc_util.js"></JS> 
<JS src="PaginacionSicc.js"></JS>
<JS src="DruidaTransactionMare.js"></JS>
<JS src="i18NJS.js"/>     
<JS src="pestanyas_concurso_inc.js"/>
<JS src="validaciones_sicc.js" />


<JAVASCRIPT>
  <![CDATA[ 

var contador;

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 function onLoadPag()   { 
    contador = 0;
    DrdEnsanchaConMargenDcho('listado1',26);
    document.all["Cplistado1"].style.visibility='';
    document.all["CpLin1listado1"].style.visibility='';
    document.all["CpLin2listado1"].style.visibility='';
    document.all["CpLin3listado1"].style.visibility='';
    document.all["CpLin4listado1"].style.visibility='';
    document.all["separa1Div"].style.visibility='hidden';
    document.all["primera1Div"].style.visibility='hidden';
    document.all["ret1Div"].style.visibility='hidden';
    document.all["ava1Div"].style.visibility='hidden';
    document.all["btnExcluirDiv"].style.visibility='';
    document.all["btnExcluirTodosDiv"].style.visibility='';
  
    eval (ON_RSZ);
  
    configurarMenuSecundario("formulario");   

	btnProxy(1, '0');
	btnProxy(2, '1');
	btnProxy(3, '0');
	btnProxy(7, '0');
	btnProxy(8, '0');
	btnProxy(9, '0');
    
    var controles = get("formulario.hPantallaParticipantesControlesOcultos");    
    if (controles =="S") mostrarLista('N');        
    else mostrarLista('S');
  
    deshabilitarBotones(); 
    
    if (get('formulario.lstClasificacionParticipantesConsultoras') != null)
            cargaLista(listado1,get('formulario.lstClasificacionParticipantesConsultoras'));
  
    if (get('formulario.lstClasificacionParticipantes') != null)
         cargaLista(listado2, get('formulario.lstClasificacionParticipantes'));
            
    if (listado1.datos.length > 0)
         set('formulario.hidUltimoElementoEnLaLista', listado2.datos.length);
         
    var menu = get("formulario.opcionMenu"); 
    if (menu == "Consultar Concurso"){
          deshabilitarHabilitarBoton('botonContenido', 'btnAnadirTodos', 'D');
          deshabilitarHabilitarBoton('botonContenido', 'btnAnadir', 'D');
          deshabilitarHabilitarBoton('botonContenido', 'btnAceptar', 'D');
//Cleal - INC 06
//          deshabilitarHabilitarBoton('botonContenido', 'btnEstatusVenta', 'D');
          deshabilitarHabilitarBoton('botonContenido', 'btnExcluir', 'D');
          deshabilitarHabilitarBoton('botonContenido', 'btnExcluirTodos', 'D');   
    }

	var datosLista1 = listado1.datos;
	var datosLista2 = listado2.datos;

	var datosFinales = new Array();
	var k = 0;

	//De la lista Clasificacion participantes se quitan los registros
	//que ya existan en la lista Clasificacion participantes calificacion
	for(var j=0; j<datosLista2.length; j++) {
		var igual = "false";

		for(var i=0; i<datosLista1.length; i++) {
			if(datosLista2[j][0]==datosLista1[i][1]) igual = "true";
		}

		if(igual=="false") {
			datosFinales[k] = datosLista2[j];
			k++;
		}
	}

	listado2.setDatos(datosFinales);
	listado2.actualizaDat();
	if (menu != "Consultar Concurso"){
		onTabAnadirTodos();
	}
 }
 
// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 function mostrarLista(estado){   
   
   estado = "S";
   
   
   if (estado == 'N'){
      document.getElementById('panel').height = 320;
       DrdEnsanchaConMargenDcho('listado2',26);
       document.all["Cplistado2"].style.display='none';
       document.all["CpLin1listado2"].style.display='none';
       document.all["CpLin2listado2"].style.display='none';
       document.all["CpLin3listado2"].style.display='none';
       document.all["CpLin4listado2"].style.display='none';
       document.all["separa2Div"].style.display='none';
       document.all["primera2Div"].style.display='none';
       document.all["ret2Div"].style.display='none';
       document.all["ava2Div"].style.display='none';
       document.all["btnAnadirDiv"].style.display='none';
       document.all["btnAnadirTodosDiv"].style.display='none';
       deshabilitarHabilitarBoton('botonContenido','btnExcluir','D');
       deshabilitarHabilitarBoton('botonContenido','btnExcluirTodos','D');
       
  }else{
          DrdEnsanchaConMargenDcho('listado2',26);
          document.all["Cplistado2"].style.visibility='visible';
          document.all["CpLin1listado2"].style.visibility='visible';
          document.all["CpLin2listado2"].style.visibility='visible';
          document.all["CpLin3listado2"].style.visibility='visible';
          document.all["CpLin4listado2"].style.visibility='visible';
          document.all["separa2Div"].style.visibility='visible';
          document.all["primera2Div"].style.visibility='visible';
          document.all["ret2Div"].style.visibility='visible';
          document.all["ava2Div"].style.visibility='visible';
          document.all["btnAnadirDiv"].style.visibility='visible';
          document.all["btnAnadirTodosDiv"].style.visibility='visible';
          deshabilitarHabilitarBoton('botonContenido','btnExcluir','A');
          deshabilitarHabilitarBoton('botonContenido','btnExcluirTodos','A');
   }
   eval (ON_RSZ);
 }
 
 
    

  function deshabilitarBotones(){
	//Se deshabilita el boton estatus venta si es "Dirigido a gerentes"
    if(get('formulario.hEstadoBtnEstatusVenta')=='N'){
      deshabilitarHabilitarBoton('botonContenido', 'btnEstatusVenta', 'D');
    }
  }
  
  // ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  function ocultarListaParticipantes(){
    //lista
    document.all["Cplistado2"].style.visibility='';
    document.all["CpLin1listado2"].style.visibility='';
    document.all["CpLin2listado2"].style.visibility='';
    document.all["CpLin3listado2"].style.visibility='';
    document.all["CpLin4listado2"].style.visibility='';
    document.all["separa2Div"].style.visibility='';
    document.all["primera2Div"].style.visibility='';
    document.all["ret2Div"].style.visibility='';
    document.all["ava2Div"].style.visibility='';
    document.all["btnAnadirDiv"].style.visibility='';
    document.all["btnAnadirTodosDiv"].style.visibility='';

    //botones
    document.all["btnAnadirDiv"].style.visibility='';
    document.all["btnAnadirTodosDiv"].style.visibility='';
    document.all["btnExcluirDiv"].style.visibility='';
    document.all["btnExcluirTodosDiv"].style.visibility='';
    document.getElementById('panel').height = 320;
  
 }  
  
// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function cargaLista(lista, items) { 
  if (items != null) {
   actualizaListado(lista, items);
 }
}

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function actualizaListado(lista, listaItems){
		var fila = listaItems.split('$');
		for(i=0;i<fila.length;i++){
			if (fila[i] != ''){
				var newRow = new Array();
				newRow = fila[i].split("|");
				lista.insertar(newRow);
			}
		}
}
   
// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  function fVolver(){
        window.close();
    }

function fLimpiar() {
	focalizaBotonHTML('botonContenido','btnAceptar');	
}

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function accionExcluir(){
	listado1.actualizaDat();
	listado2.actualizaDat();
	excluyeEltosSel(listado1, listado2);
}

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function excluyeEltosSel(listaOr, listaDe){
	var codSelecc = listaOr.codSeleccionados(); 
	var cantTemp = codSelecc.length;
	var datos = listaOr.codigos();   

	//VERIFICA QUE HAYA SELECCIONADO UN REGISTRO
	if (codSelecc == ""){
		GestionarMensaje("4", null, null, null);
		return;
	}  

	//OBTENER LA MATRIZ A INSERTAR EN LA LISTA CLASIFICACION
	//PARTICIPANTES, SE OBTIENE EL OID DE PARTICIPANTE Y LA DESCRIPCION
	var toAdd = "";
	for(var i=0; i<cantTemp; i++) {	
		if(i==0)  {
		    toAdd = listaOr.extraeDato(codSelecc[i], 0) + "|" + listaOr.extraeDato(codSelecc[i], 2); 
		}
		else {			
			toAdd = toAdd + "$" + listaOr.extraeDato(codSelecc[i], 0) + "|" + listaOr.extraeDato(codSelecc[i], 2);
		}		
	}

	//ELIMINAR LOS PARTICIPANTES IGUALES
	var arrayNuevo = new Array();
	var g = 0;
	for(var i=0; i<datos.length; i++) {
		var inserto = "true";
		for(var j=0; j<codSelecc.length; j++) {
			if((listaOr.datos[i][1]==listaOr.extraeDato(codSelecc[j], 0))) {
				inserto = "false";
			}
		}
		if(inserto=="true") {
			arrayNuevo[g] = listaOr.datos[i];
			g++;
		}
	}
	listaOr.setDatos(arrayNuevo);
	//ELIMINAR LOS PARTICIPANTES IGUALES


	
	//YA TENGO LA MATRIZ A INSERTAR, PERO ANTES SE TIENEN QUE 
	//ELIMINAR LAS CLASIFICACIONES REPETIDAS, SI ES QUE HAY
    var filas = new Array();  
	filas = toAdd.split("$");	
	var listaDes = listaDe.datos;

	for(var i=0; i<filas.length; i++) {		
		var registro = new Array();
		registro = filas[i].split("|");
		var inserto = "true";

		for(var j=0; j<listaDes.length; j++) {
			if(registro[0]==listaDes[j][0]) inserto = "false";
		}	
	
		if(inserto=="true") listaDe.insertar(registro);
	}

	listaOr.eliminarSelecc();
 }

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function accionExcluirTodos(){
  excluyeTodosLosEltos(listado1, listado2);  
}


// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function excluyeTodosLosEltos(listaOr, listaDe){  
  listaOr.actualizaDat();
  listaDe.actualizaDat();
   
  var codigo = listaOr.codigos();
  lon =  codigo.length;  
   
  var cant = get("formulario.hCantidad");    
  total = lon/cant;  
  var dato = "";
  
	for(var a = 0; a < lon ; a++){                   
       var dos = listaOr.extraeDato(codigo[a], 0);             
       toAdd = dos + "|" + listaOr.extraeDato(codigo[a], 2);                   
       var newRow = new Array();
       newRow = toAdd.split("|");
        
       if (dato == newRow[1]){
       }
       else{
	       listaDe.insertar(newRow);
       }
       
       dato = listaOr.extraeDato(codigo[a], 2);        
     } 
          
     var nuevos_datos = new Array();
     listaOr.setDatos(nuevos_datos);
  }


// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function isInListado2(item, listaDestino){
   
   listaDestino.actualizaDat();
   var codListD = listaDestino.codigos();
   
   var lonLisD = listaDestino.datos.length; 
  
   var estaEnLista = 0;
        
   for(var b = 0; b < lonLisD ; b++){  
    
      if (item == codListD[b]){
       estaEnLista = 1;           
    
      }
   }
   return estaEnLista;
 }

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function accionAniadir(){
 var oidDirigido = get("formulario.oidDirigidoA");
 var constante = get("formulario.cteOidDirigidoAConsultora");
 var listaEstatus = get("formulario.hidLstEstatusVta"); 

 if (oidDirigido == constante){  
	if(listaEstatus !=""){
		aniadeEltosSel(listado2, listado1); 
	}
	else{
		GestionarMensaje("10000", null, null, null);     
	}      
 }
 else {
	 aniadeEltosSel2(listado2,listado1); 
 }
}

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function aniadeEltosSel2(listaOr, listaDe){
    listaOr.actualizaDat();
    listaDe.actualizaDat();   
    
    var cantElementosL2 = listaOr.codSeleccionados();		      
    
    if (cantElementosL2.length == 0){
       GestionarMensaje("4", null, null, null);
       return;
    }
        
    var codigo = listaOr.codSeleccionados();  
    var total = "";
    lon = codigo.length;      
 
    for(var a = 0; a < lon ; a++){
        if (isInListado1(codigo[a], listaDe) == 0) {            
                var posi = parseInt(get('formulario.hidUltimoElementoEnLaLista'), 10);                
                var datosLista = get("formulario.hidLstEstatusVta");
                var listaParseada = parsearDatosLista(datosLista);                 
                var cant = get("formulario.hCantidad");    
                var dos =  get("formulario.dEstatus");
                var oid = get("formulario.oEstatus");                          
                
                for(t=0; t < cant ; t++){          
                    var valor = dos.split(",");     
                    //var iPos = listaDe.generaCodigo( posi );                   
					var iPos = "G" + contador;
                    toAdd = iPos + "|" + codigo[a] +"|" + " " + "|" + listaOr.extraeDato(codigo[a], 0) ;             
                    toAdd = toAdd + "|" + " " + "|";                    
                    var newRow = new Array();
                    newRow = toAdd.split("|");                    
                    listaDe.insertar(newRow);     
					contador++; 
                }
                set('formulario.hidUltimoElementoEnLaLista', iPos);
            }
        }
        listaOr.eliminarSelecc();        
		cantElementosL1 = "";     
}


// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function aniadeEltosSel(listaOr, listaDe){
    listaOr.actualizaDat();
    listaDe.actualizaDat();   
    
    var cantElementosL1 = "";
 
    cantElementosL1 = listaOr.codSeleccionados();		    
    
    if (cantElementosL1.length == 0){
       GestionarMensaje("4", null, null, null);
       return;
    }

    var total = "";
    lon = cantElementosL1.length;
    
    for(var a = 0; a < lon ; a++){
        if (isInListado1(cantElementosL1[a], listaDe) == 0) {
                var posi = parseInt(get('formulario.hidUltimoElementoEnLaLista'), 10);                
                var datosLista = get("formulario.hidLstEstatusVta");
                var listaParseada = parsearDatosLista(datosLista);                 
                var cant = get("formulario.hCantidad");    
                var dos =  get("formulario.dEstatus");
                var oid = get("formulario.oEstatus");                          
                
                for(t=0; t < cant ; t++){          
                    var valor = dos.split(",");     
				    var oidParseados = oid.split(",");					
                    //var iPos = listaDe.generaCodigo( posi );
					var iPos = "G" + contador;
                   
                    toAdd = iPos + "|" + cantElementosL1[a] +"|" + oidParseados[t] + "|" + listaOr.extraeDato(cantElementosL1[a], 0);
                    toAdd = toAdd + "|" + valor[t] + "|";          
                    var newRow = new Array();
                    newRow = toAdd.split("|");                    
                    listaDe.insertar(newRow);
					contador++;               
                }
                set('formulario.hidUltimoElementoEnLaLista', iPos);
            }
        }
        listaOr.eliminarSelecc();        
	    cantElementosL1 = "";     
}


// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function parsearDatosLista(datos) {      
        var newRow = new Array();      
        newRow = datos.split(",");
        
        var oidEstatus = new Array();
        var descEstatus = new Array();               
        var cantidadFilas = newRow.length/8;
        
        set("formulario.hCantidad" , cantidadFilas);

		  // Modificado por ssantana, 
		  var indiceOid = 2;
		  var indiceDesc = 5
		  for (var i = 0; i < cantidadFilas; i++)
		  {
				var oid = newRow[indiceOid];
				var desc = newRow[indiceDesc];

				if ( i != 0) {
						oidEstatus = oidEstatus + "," 
						descEstatus = descEstatus + " ,"
				}

				oidEstatus = oidEstatus + oid;
				descEstatus = descEstatus + desc;

				indiceOid = indiceOid + 8;
				indiceDesc = indiceDesc + 8;

		  }
		  // Fin modificacion ssantana.
        
        set("formulario.oEstatus" , oidEstatus);
        set("formulario.dEstatus" , descEstatus);
		//alert("oidEstatus: "+oidEstatus);
		//alert("descEstatus: "+descEstatus);
 
  }

// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function isInListado1(item, listaDestino){
	listaDestino.actualizaDat();
	var codListD = listaDestino.codigos();
	var lonLisD = listaDestino.datos.length;        
	var estaEnLista = 0;
        
	for(var b = 0; b < lonLisD ; b++){     
	  var vDestino = listaDestino.extraeDato(codListD[b], 0);     
	
	  if (item == vDestino) estaEnLista = 1;       
    }
   
    return estaEnLista;
}




// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function accionAniadirTodos(){
 var oidDirigido = get("formulario.oidDirigidoA");
 var constante = get("formulario.cteOidDirigidoAConsultora"); 
 var listaEstatus = get("formulario.hidLstEstatusVta");

 if (oidDirigido == constante){ 
    if(listaEstatus !=""){       
         aniadeLosEltos(listado2, listado1);
     }
	 else{
        GestionarMensaje("10000", null, null, null);     
     }   
  } 
  else {     
     aniadeTodosLosEltos(listado2, listado1);
  } 
} 


// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function aniadeLosEltos(listaOr, listaDe){ //5 
 listaOr.actualizaDat();
 listaDe.actualizaDat();
 
 var codigo = listaOr.codigos();
 lon =  codigo.length;
    
  for(var a = 0; a < lon ; a++){//4  
        if (isInListado1(codigo[a], listaDe) == 0) {//3
            
                var posi = parseInt(get('formulario.hidUltimoElementoEnLaLista'), 10);               
                
                var datosLista = get("formulario.hidLstEstatusVta");
                var listaParseada = parsearDatosLista(datosLista); 
                
                var cant = get("formulario.hCantidad");    
                var dos =  get("formulario.dEstatus");
                var oid = get("formulario.oEstatus");				 
                
                for(t=0; t < cant ; t++){ //2
         
						  // Agregado por ssantana, 1/7/2005
						  var oidParseados = oid.split(",");
						  // Fin Agregado por ssantana, 1/7/2005

                    var valor = dos.split(",");            
                    //var iPos = listaDe.generaCodigo( posi );         
					var iPos = "G" + contador;                   
                    
                    toAdd = iPos + "|" + codigo[a] +"|" + oidParseados[t] + "|" + listaOr.extraeDato(codigo[a], 0) ;
                    toAdd = toAdd + "|" + valor[t] + "|";
                    
                    
                    var newRow = new Array();
                    newRow = toAdd.split("|");
                    
                    
                    listaDe.insertar(newRow);
					contador++;      
               
                }//2 
                set('formulario.hidUltimoElementoEnLaLista', iPos);
            }//3
        }//4
        
        
        
       var nuevos_datos = new Array();
        listaOr.setDatos(nuevos_datos);
   }//5
   
   
// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function aniadeTodosLosEltos(listaOr, listaDe){ //5
 
 listaOr.actualizaDat();
 listaDe.actualizaDat();
 
 var codigo = listaOr.codigos();

 lon =  codigo.length;
 
		for(var a = 0; a < lon ; a++){ 
  
          if (isInListado1(codigo[a], listaDe) == 0) 
            {//3
            
                var posi = parseInt(get('formulario.hidUltimoElementoEnLaLista'), 10);
           
                
                var datosLista = get("formulario.hidLstEstatusVta");
                
                if (datosLista != ""){
                      var listaParseada = parsearDatosLista(datosLista); 
                
                      var cant = get("formulario.hCantidad");    
                      var dos =  get("formulario.dEstatus");
                      var oid = get("formulario.oEstatus");
                      
                      
                      var valor = dos.split(",");
                }
            
                        
                    //var iPos = listaDe.generaCodigo( posi );          
					var iPos = "G" + contador;
                   
                    
                    toAdd = iPos + "|" + codigo[a] +"|" + " " + "|" + listaOr.extraeDato(codigo[a], 0) ;
                    toAdd = toAdd + "|" + " " + "|";
                    
                    
                    var newRow = new Array();
                    newRow = toAdd.split("|");
                    
                    
                    listaDe.insertar(newRow);
					contador++;  
               
             //   }//2 
                set('formulario.hidUltimoElementoEnLaLista', iPos);
            }//3
        }//4       
        
        
       var nuevos_datos = new Array();
        listaOr.setDatos(nuevos_datos);
   }//5
   
   
// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------   
function accionEstatusVenta(){

  var parametros = new Object();  
  parametros.opcionMenu = get('formulario.opcionMenu');
  
  //var listasEstatusVenta =  mostrarModalSICC("LPMantenerParametrosConsultoras", "cargar estatus venta", parametros,800,500);
var listasEstatusVenta =  mostrarModalSICC("LPMantenerParametrosConsultoras", "cargar estatus venta calificacion", parametros,800,500);
  // Agregado por ssantana, contempla que listaEstatusVenta puede venir nulo si se cerró la ventana 
  // desde la barra de título (1/7/2005)
  if (listasEstatusVenta != null && listasEstatusVenta != undefined) {
	  var uno = listasEstatusVenta[0];  
	  var dos = listasEstatusVenta[1];
	  //alert("uno: "+uno);
	  //alert("dos: "+dos);
	  set("formulario.tempEstatusVenta", uno);

	  // Agregado por ssantana, 30/6/2005
	  // Almacena en Sesion lo que se trajo de Estatus Venta.
	  eval('formulario').oculto = 'S';
	  set('formulario.accion', 'almacenarModalEstatusVenta');
	  set('formulario.conectorAction', 'LPMantenerParametrosCalificacion');
	  set('formulario.hidLstEstatusVta', uno);
	  enviaSICC('formulario', null, null, 'N');
	  // Fin agregado  por ssantana, 30/6/2005

	  set('formulario.hidLstEstatusVta', dos);
  }


}

function despuesAlmacenarEstatusVenta() {
	btnProxy(1, '0');
	btnProxy(2, '1');
	btnProxy(3, '0');
	btnProxy(7, '0');
	btnProxy(8, '0');
	btnProxy(9, '0');

    var datosLista = get("formulario.hidLstEstatusVta");
    var listaParseada = parsearDatosLista(datosLista);                 
    var oid = get("formulario.oEstatus");    
    var oidParseados = oid.split(",");		
	var datosLista1 = listado1.datos;
	var arrayAuxiliar = new Array();
	var h = 0;

	if(datosLista1.length > 0) {
		for(var i=0; i<datosLista1.length; i++) {
			//********** PARA BORRAR *************
			var encontro = "false";	

			for(var j=0; j<oidParseados.length; j++) {
				if(datosLista1[i][2]==oidParseados[j]){
					encontro = "true";
					//alert("datosLista1[i][2]: "+datosLista1[i][2]);
				}
			}		

			if(encontro=="true") {
				arrayAuxiliar[h] = datosLista1[i];
				h++;
			}
			//********** PARA BORRAR *************
		}			
	}

	listado1.actualizaDat();
	var datosLista1Act = listado1.datos;
	var datosLista2Act = listado1.datos;
	//*********** PARA BAJAR ************
	for(var i=0; i<datosLista1Act.length; i++) {
		var contador = 0;			
		
		for(var j=0; j<datosLista2Act.length; j++) {
			if(datosLista1Act[i][1] == datosLista2Act[j][1]) {
				contador++;
			}
		}
		
		if(contador == 1) {
			var id = datosLista1Act[i][0];
			bajarHaciaParticipantes(id, datosLista1Act);
		}
	}
	//*********** PARA BAJAR *************

	listado1.setDatos(arrayAuxiliar);
}

function obtieneFilaSegunId(id, lista) {
	var pos;
	for(var i=0; i<lista.length; i++) {
		if(id==lista[i][0]) {
			pos = i;
		}
	}
	return pos;
}

function bajarHaciaParticipantes(id, lista){
	var codSelecc = new Array(); 
	codSelecc[0] = id;
	var cantTemp = codSelecc.length;

	//OBTENER LA MATRIZ A INSERTAR EN LA LISTA CLASIFICACION
	//PARTICIPANTES, SE OBTIENE EL OID DE PARTICIPANTE Y LA DESCRIPCION
	var toAdd = "";
	for(var i=0; i<cantTemp; i++) {	

		var pos = obtieneFilaSegunId(codSelecc[i], lista);

		if(i==0) toAdd = lista[pos][1] + "|" + lista[pos][3]; 
		else toAdd = toAdd + "$" + lista[pos][1] + "|" + lista[pos][3];	
	}
	
	//YA TENGO LA MATRIZ A INSERTAR
    var filas = new Array();  
	filas = toAdd.split("$");	

	for(var i=0; i<filas.length; i++) {		
		var registro = new Array();
		registro = filas[i].split("|");
	
		listado2.insertar(registro);
	}
 }

function listado1Tostring(){        
        listado1.actualizaDat();
        var codigo = listado1.codigos();
        
        var total = "";
        for(var a = 0; a < codigo.length ; a++){            
            var toAdd = "";        
            toAdd = codigo[a];
            
            if(listado1.extraeDato(codigo[a], 0)!= null && listado1.extraeDato(codigo[a], 0)!="") {                 
                 toAdd = toAdd + "," + listado1.extraeDato(codigo[a], 0);    //oidParticipante
			}
			else {
			     toAdd = toAdd + "," + " "; 
			}
            
            if(listado1.extraeDato(codigo[a], 1)!= null && listado1.extraeDato(codigo[a], 1)!="") {
				  toAdd = toAdd + "," + listado1.extraeDato(codigo[a], 1);    //oidEstatusVenta
			}
			else {
			     toAdd = toAdd + "," + " "; 
			}
            
            if(listado1.extraeDato(codigo[a], 2)!= null && listado1.extraeDato(codigo[a], 2)!="") {
                 toAdd = toAdd + "," + listado1.extraeDato(codigo[a], 2);    //DescripcionPart 
			}
			else {
			     toAdd = toAdd + "," + " "; 
			}
        
            if(listado1.extraeDato(codigo[a], 3)!= null && listado1.extraeDato(codigo[a], 3)!="") {
                 toAdd = toAdd + "," + listado1.extraeDato(codigo[a], 3);    //DescripcionEstatus
			} 
			else {
			     toAdd = toAdd + "," + " "; 
			}
        
            if(listado1.extraeDato(codigo[a], 4)!= null && listado1.extraeDato(codigo[a], 4)!="") {
				toAdd = toAdd + "," + listado1.extraeDato(codigo[a], 4);    //MontoMinimo
		    }
			else {
			     toAdd = toAdd + "," + " "; 
			}
            
			total = total + "|" + toAdd;                    
		}	
        
    total = total + "|";    
	return total;
	}  
  
function listado2Tostring(){    
    listado2.actualizaDat();
    var codigo = listado2.codigos();
    var total = "";
    
    for(var a = 0; a < codigo.length ; a++){
	    var toAdd = "";
        toAdd = codigo[a];

        if(listado2.extraeDato(codigo[a], 0)!= null && listado2.extraeDato(codigo[a], 0)!="")
            toAdd = toAdd + "," + listado2.extraeDato(codigo[a], 0);    //Descripcion

		total = total + "|" + toAdd;
	}	
    
    total = total + "|";      
	return total;
}

function accionAceptar(){
		listado1.actualizaDat();
		
		//Primero se valida que se ingrese un valor para la columna Monto minimo
		var devuelto = sicc_valida_requerido_LE('txtMontoMin', GestionarMensaje("1577", null, null, null), 
		'listado1', 5);

		if(devuelto==true) {
			//Despues se valida el tipo de dato de la columna Monto minimo
			var retorno = sicc_valida_numero_LE('txtMontoMin', GestionarMensaje("1577", null, null, null), 0, 	99999999999.99, 'Numerico', 'listado1', 5);

			if(retorno==true) {
				var listaCalificacionParticipantes = listado1Tostring();        			
				var listaParticipantes = listado2Tostring();        		   
				var lstEstatusVenta = listado3Tostring();  
				var v = listaCalificacionParticipantes + '~' + listaParticipantes + '~' + lstEstatusVenta;			

				// Agregado por ssantana, 29/6/2005
				//   Se llama a la LP para que grabe el cambio ingresado por el usuario en el DTO 
				//   (cuando no sea Consulta) - Esto no está en el DMCO
				eval('formulario').oculto = 'S';
				set('formulario.accion', 'almacenarModalParticipantes');
				set('formulario.conectorAction', 'LPMantenerParametrosCalificacion');
				set('formulario.varListaCalificacionParticipantes', listaCalificacionParticipantes);
				set('formulario.varListaParticipantes', listaParticipantes);
				set('formulario.varEstatusVenta', lstEstatusVenta);
				set('formulario.listasCalificacion', v);
				enviaSICC('formulario');
				// Fin Agregado por ssantana, 29/6/2005
			}
			else {
				return false;
			}		
		}
		else {
			return;
		}
}

function cierraModalOK(cadenaRetorno) {
	returnValue = cadenaRetorno;
	
	close();
}

function listado3Tostring(){
   var datosEstatus = get("formulario.hidLstEstatusVta");   
   var fila = datosEstatus.split(',');  
   return fila;  
}

function onTabExcluirTodos() {
	focalizaBotonHTML_XY('btnAnadir');	
}

function onTabAnadirTodos() {
	focalizaBotonHTML('botonContenido','btnAceptar');	
}

function onTabAceptar() {
	if(document.getElementById("btnEstatusVenta").disabled == true) {
		focalizaBotonHTML_XY('btnExcluir');	
	}
	else {
		focalizaBotonHTML('botonContenido','btnEstatusVenta');	
	}
}

function onShTabAceptar() {
	focalizaBotonHTML_XY('btnAnadirTodos');	
}

function onShTabAnadir() {
	focalizaBotonHTML_XY('btnExcluirTodos');	
}

function onShTabExcluir() {
	if(document.getElementById("btnEstatusVenta").disabled == true) {
		focalizaBotonHTML('botonContenido','btnAceptar');
	}
	else {
		focalizaBotonHTML('botonContenido','btnEstatusVenta');	
	}	
}

function onTabEstatusVenta() {
	focalizaBotonHTML_XY('btnExcluir');	
}

 ]]> 
</JAVASCRIPT>
 
<FORMULARIO nombre="formulario">

<VAR nombre="conectorAction" valor=""/>
<VAR nombre="accion" valor=""/>
<VAR nombre="errCodigo" valor=""/> 
<VAR nombre="errDescripcion" valor=""/>

<VAR nombre="opcionMenu" valor=""/>
<VAR nombre="oidDirigidoA" valor=""/>
<VAR nombre="cteOidDirigidoAConsultora" valor=""/>
<VAR nombre="hidLstEstatusVta" valor=""/>

<VAR nombre="oEstatus" valor=""/>
<VAR nombre="dEstatus" valor=""/>

<VAR nombre="hCantidad" valor=""/>


<!-- Agregado por ssantana, 29/6/2005 -->
<VAR nombre="listasCalificacion" valor=""/>  <!-- En la LP se obtiene esta variable, pero faltaba en el xml -->
<VAR nombre="varListaCalificacionParticipantes" valor=""/>		
<VAR nombre="varListaParticipantes" valor=""/>
<VAR nombre="varEstatusVenta" valor=""/>
<!-- Fin agregado por ssantana, 29/6/2005 -->

<!--Estado de Botones. 'S' == habilitado-->
<VAR nombre="hEstadoBtnEstatusVenta" valor=""/>
<VAR nombre="hPantallaParticipantesControlesOcultos" valor="S"/>
<VAR nombre="hidUltimoElementoEnLaLista" valor="1"/>
<VAR nombre="lstClasificacionParticipantes" valor=""/>
<VAR nombre="lstParticipantes" valor=""/>

<VAR nombre="tempEstatusVenta" valor=""/>

<CAPA nombre="capaEspacio1" x="0" y="0">
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td width="12" align="center"><IMG src="b.gif" width="12" height="12"/></td>
      <td width="750"><IMG src="b.gif"/></td>
      <td width="12"><IMG src="b.gif" width="12" height="1"/></td>
    </tr>
    <tr> 
      <td><IMG src="b.gif"/></td>
      <td>
	<fieldset><legend class="legend"><LABELC nombre="lblParticipantes"  alto="13" filas="1" valor="" id="legend" cod="0022"/></legend>
	  <table width="100%" border="0" align="center" cellspacing="0" cellpadding="0">
            <tr>
              <td>
                <table width="648" align="left"  border="0" cellspacing="0" cellpadding="0">
		  <tr>
		    <td colspan="3"><IMG src="b.gif" ID="panel" width="8" height="653"/></td><!--height="653" 320-->
		  </tr>
	        </table>
	      </td>
	    </tr>    
          </table>        
        </fieldset>
      </td>
    </tr>
    <tr> 
      <td><IMG src="b.gif"/></td>
      <td>
	<fieldset>
	  <table width="100%" border="0" align="center" cellspacing="0" cellpadding="0">        
	    <tr>
	      <td class="botonera">
	        <BOTON nombre="btnAceptar" ID="botonContenido" tipo="html" estado="false" cod="12" accion="accionAceptar();" ontab="onTabAceptar();" onshtab="onShTabAceptar();"/>
	        <BOTON nombre="btnEstatusVenta" ID="botonContenido" tipo="html" estado="false" cod="1701" accion="accionEstatusVenta();" ontab="onTabEstatusVenta();"/>
	      </td>
            </tr>    
          </table>        
        </fieldset>
      </td>
      <td><IMG src="b.gif" width="8" height="12"/></td>
    </tr> 
    <tr>
       	<td width="12" align="center"><IMG src="b.gif" width="12" height="12"/></td>
     	<td width="756" ><IMG src="b.gif"/></td>
      	<td width="12" ><IMG src="b.gif" width="12" height="1"/></td>
    </tr>
  </table>
</CAPA>

<!-- Cuando el campo "Dirigido a" de la pantalla principal sea "Gerente", la columna "Estatus venta MAE" de la lista "listado1" se debe ocultar-->

  <LISTAEDITABLE nombre="listado1" ancho="620" alto="301" x="26" y="37" colorFondo="#CECFCE" msgDebugJS="S">
      <IMGBOTONES precarga="S" conROver="S">
        <BTNSELECCION normal="btnLista2N.gif" rollOver="btnLista2S.gif" seleccionado="btnLista2M.gif" desactivado="btnLista2D.gif" /> 
        <BTNMINIMIZAR minimizar="bot_pliega_columna_on.gif" minimROver="bot_pliega_columna_over.gif" maximizar="bot_despliega_columna_on.gif" maximROver="bot_despliega_columna_over.gif" /> 
       <BTNORDENAR ordenar="ascendente_on.gif" ordenarInv="descendente_on.gif"/>   
      </IMGBOTONES>
      <LINEAS>
        <GROSOR borde="1" horizDatos="1" horizCabecera="1" vertical="0" horizTitulo="1" horizBase="1"/> 
        <COLOR borde="#999999" vertCabecera="#E0E0E0" vertDatos="#FFFFFF" horizDatos="#FFFFFF" horizCabecera="#999999" horizTitulo="#999999" horizBase="#999999" /> 
      </LINEAS>
      <TITULO colFondo="#CECFCE" alto="22" imgFondo="" cod="00382" ID="datosTitle" />
      <BASE colFondo="#CECFCE" alto="22" imgFondo=""/>

      <COLUMNAS ajustarMinimo="S" permiteOrdenar="S" blancosAInsertar="1" sinSaltoLinea="S" AnchoMinimizadas="20" botonOrdenar="S">
         <COL ancho="60" minimizable="S" minimizada="N" oculta="S"/>
         <COL ancho="60" minimizable="S" minimizada="N" oculta="S"/>
         <COL ancho="130" minimizable="S" minimizada="N"/>
         <COL ancho="130" minimizable="S" minimizada="N"/>
         <COL ancho="60" minimizable="S" minimizada="N"/>
         
      </COLUMNAS>
      <CABECERA alto="20" IDScroll="EstCab" imgFondo="" colFondo="#CCCCCC">
	<COL colFondo="" ID="EstCab" >oidParticipante</COL> 
	<COL colFondo="" ID="EstCab" >oidEstatusVenta</COL> 
	<COL colFondo="" ID="EstCab" cod="9">Descripcion</COL> 
	<COL colFondo="" ID="EstCab" cod="1705">Estatus venta MAE</COL> 
	<COL colFondo="" ID="EstCab" cod="469">Monto mín.</COL> 
      </CABECERA>
      <DATOS alto="22" accion="" tipoEnvio="edicion" formaEnvio="xml" maxSel="-1" msgErrMaxSel="" 
             coloresScrollNativo="#D4D0C8,black,white,#D4D0C8,#D4D0C8,#ECE9E4,black" colorROver="#D0D9E8" 
             onLoad="" colorSelecc="#D0D9E8">
      
	   <COL tipo="texto" ID="EstDat"/> 
       <COL tipo="texto" ID="EstDat2"/> 
       <COL tipo="texto" ID="EstDat"/> 
       <COL tipo="texto" ID="EstDat2"/>
       <COL tipo="cajatexto" nombre="txtMontoMin" size="16" max="13" ID="EstDat" IDOBJ="EstCajaDatForm"/> 

      </DATOS>
      <ROWSET>
	
      </ROWSET>
     <PAGINADO nombre="mipgndo" ancho="620" sep="$" x="26" class="botonera" y="315" control="|" conector="conectorSandra" rowset="" cargainicial="N">
        <BOTON nombre="ret1" x="51" y="319" ID="botonContenido" img="retroceder_on" tipo="0" estado="false" alt="" codigo="" accion="mipgndo.retroceder();" /> 
        <BOTON nombre="ava1" x="66" y="319" ID="botonContenido" img="avanzar_on" tipo="0" estado="false" alt="" codigo="" accion="mipgndo.avanzar();"/>
    </PAGINADO>
  </LISTAEDITABLE>
  <BOTON nombre="primera1" x="34" y="319" ID="botonContenido" img="primera_on" tipo="-2" estado="false" alt="" codigo="" accion="mipgndo.retrocederPrimeraPagina();" />      
  <BOTON nombre="separa1" x="73" y="315" ID="botonContenido" img="separa_base" tipo="0" estado="false" alt="" codigo="" accion="" />      
  <BOTON nombre="btnExcluir" x="27" y="316" ID="botonContenido" tipo="html" estado="false" cod="2421" accion="accionExcluir();" onshtab="onShTabExcluir();"/> 
  <BOTON nombre="btnExcluirTodos" x="75" y="316" ID="botonContenido" tipo="html" estado="false" cod="2422"  accion="accionExcluirTodos();" ontab="onTabExcluirTodos();"/> 

  <LISTAEDITABLE nombre="listado2" ancho="620" alto="301" x="26" y="362" colorFondo="#CECFCE" msgDebugJS="S">
      <IMGBOTONES precarga="S" conROver="S">
        <BTNSELECCION normal="btnLista2N.gif" rollOver="btnLista2S.gif" seleccionado="btnLista2M.gif" desactivado="btnLista2D.gif" /> 
        <BTNMINIMIZAR minimizar="bot_pliega_columna_on.gif" minimROver="bot_pliega_columna_over.gif" maximizar="bot_despliega_columna_on.gif" maximROver="bot_despliega_columna_over.gif" /> 
        <BTNORDENAR ordenar="ascendente_on.gif" ordenarInv="descendente_on.gif"/>   
      </IMGBOTONES>
      <LINEAS>
        <GROSOR borde="1" horizDatos="1" horizCabecera="1" vertical="0" horizTitulo="1" horizBase="1"/> 
        <COLOR borde="#999999" vertCabecera="#E0E0E0" vertDatos="#FFFFFF" horizDatos="#FFFFFF" horizCabecera="#999999" horizTitulo="#999999" horizBase="#999999" /> 
      </LINEAS>
      <TITULO colFondo="#CECFCE" alto="22" imgFondo="" cod="00313" ID="datosTitle" />
      <BASE colFondo="#CECFCE" alto="22" imgFondo=""/>

      <COLUMNAS ajustarMinimo="S" permiteOrdenar="S" blancosAInsertar="1" sinSaltoLinea="S" AnchoMinimizadas="20" botonOrdenar="S">
        <COL ancho="100" minimizable="S" minimizada="N"/>
         <COL ancho="30" minimizable="S" minimizada="N" oculta="S"/>
        <COL ancho="30" minimizable="S" minimizada="N" oculta="S"/>
         
      </COLUMNAS>
      <CABECERA alto="20" IDScroll="EstCab" imgFondo="" colFondo="#CCCCCC">
      <COL colFondo="" ID="EstCab" cod="9">Descripción</COL>
       <COL colFondo="" ID="EstCab">oidParticipanteCalificacion</COL> 
        <COL colFondo="" ID="EstCab">oidParticipante</COL>         
	
      </CABECERA>
      <DATOS alto="22" accion="" tipoEnvio="edicion" formaEnvio="xml" maxSel="-1" msgErrMaxSel="" 
             coloresScrollNativo="#D4D0C8,black,white,#D4D0C8,#D4D0C8,#ECE9E4,black" colorROver="#D0D9E8" 
             onLoad="" colorSelecc="#D0D9E8">
       <COL tipo="texto" ID="EstDat"/> 
       <COL tipo="texto" ID="EstDat2"/>
       <COL tipo="texto" ID="EstDat"/> 
      </DATOS>
      <ROWSET>

      </ROWSET>
     <PAGINADO nombre="mipgndo2" ancho="620" sep="$" x="26" class="botonera" y="640" control="|" conector="conectorSandra1" rowset="" cargainicial="N">
        
        <BOTON nombre="ret2" x="51" y="644" ID="botonContenido" img="retroceder_on" tipo="0" estado="false" alt="" codigo="" accion="mipgndo2.retroceder();" /> 
        <BOTON nombre="ava2" x="66" y="644" ID="botonContenido" img="avanzar_on" tipo="0" estado="false" alt="" codigo="" accion="mipgndo2.avanzar();"/>
        
    </PAGINADO>
  </LISTAEDITABLE>
  <BOTON nombre="primera2" x="34" y="644" ID="botonContenido" img="primera_on" tipo="-2" estado="false" alt="" codigo="" accion="mipgndo2.retrocederPrimeraPagina();" />      
  <BOTON nombre="separa2" x="73" y="640" ID="botonContenido" img="separa_base" tipo="0" estado="false" alt="" codigo="" accion="" />      
  <BOTON nombre="btnAnadir" x="27" y="641" ID="botonContenido" tipo="html" estado="false" cod="404" accion="accionAniadir();" onshtab="onShTabAnadir();"/> 
  <BOTON nombre="btnAnadirTodos" x="75" y="641" ID="botonContenido" tipo="html" estado="false" cod="1670" accion="accionAniadirTodos();" ontab="onTabAnadirTodos();"/> 

  </FORMULARIO>
</PAGINA> 
