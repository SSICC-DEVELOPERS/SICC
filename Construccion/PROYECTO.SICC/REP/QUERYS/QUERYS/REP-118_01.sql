SELECT SOCIEDAD, 	   PERIODO VAL_NOMB_PERI, 	   UN_NEGO UNID_NEGOCIO, 	   OPERA, 	   COD_PRODU COD_SAP, 	   DESC_PRODU PROD, 	   DESC_TIPO_OPER T_OPERA, 	   UN_TIP_OPERA UNI_TIP_OPERA, 	   UN_CAN_TOTAL UNI_CAN_TOTAL FROM ( 	SELECT SOCIEDAD, 		   OPERA, 		   PERIODO, 		   UN_NEGO, 		   COD_PRODU, 		   DESC_PRODU, 		   DESC_TIPO_OPER, 		   UN_TIP_OPERA, 		   UN_CAN_TOTAL, 		   SUM(1) OVER (PARTITION BY PERIODO, OPERA, UN_NEGO ORDER BY UN_CAN_TOTAL DESC, COD_PRODU) CONTROL  	FROM 	( 		SELECT SOCI.SOCIEDAD, 			   GEN_OP.VAL_I18N OPERA, 			   PER.VAL_NOMB_PERI PERIODO, 			   GEN_UN_NEGO.VAL_I18N UN_NEGO, 			   MP.COD_SAP COD_PRODU, 			   GEN_PRODU.VAL_I18N DESC_PRODU, 			   GEN_T_OP.VAL_I18N DESC_TIPO_OPER, 			   SUM(LOR.NUM_UNID_RECL) UN_TIP_OPERA, 			   SUM(SUM(LOR.NUM_UNID_RECL)) OVER (PARTITION BY SOCI.SOCIEDAD, GEN_OP.VAL_I18N, PER.VAL_NOMB_PERI, GEN_UN_NEGO.VAL_I18N, MP.COD_SAP) UN_CAN_TOTAL 		FROM PRE_MATRI_FACTU PMF, 			 MAE_PRODU MP, 			 PRE_OFERT_DETAL POD, 			 REC_CABEC_RECLA RCR, 			 CRA_PERIO PER, 			 REC_OPERA_RECLA ROR, 			 REC_OPERA RO, 			 REC_TIPOS_OPERA RTO, 		 	 PRE_CATAL PC, 			 REC_LINEA_OPERA_RECLA LOR, 			 ( 				 SELECT P.FEC_INIC 				 FROM CRA_PERIO P 				 WHERE P.OID_PERI =  57  			 ) PER_INI, 			 ( 				 SELECT P.FEC_FINA 				 FROM CRA_PERIO P 				 WHERE P.OID_PERI = DECODE( -1 ,-1, 57 , -1 )		    			 ) PER_FIN, 			 ( 			  	SELECT SOC.VAL_DENO AS sociedad 				FROM PRINCIPALS PRI, 					PROPERTYVALUES PRO, 					SEG_SOCIE SOC			 				WHERE PRI.NAME =  'USUARIO1'  					 AND PRO.IDPROPERTY = 48 					 AND PRO.IDPRINCIPAL = PRI.IDPRINCIPAL 					 AND PRO.STRINGVALUE = SOC.OID_SOCI 		     ) SOCI, 			 ( 				SELECT GEN.VAL_OID, GEN.VAL_I18N 				FROM V_GEN_I18N_SICC GEN 				WHERE GEN.ATTR_ENTI = 'REC_OPERA' 					  AND GEN.IDIO_OID_IDIO =  1 							 			 ) GEN_OP, 			 ( 				SELECT GEN.VAL_OID, GEN.VAL_I18N 				FROM V_GEN_I18N_SICC GEN 				WHERE GEN.ATTR_ENTI = 'MAE_UNIDA_NEGOC' 					  AND GEN.IDIO_OID_IDIO =  1 							 			) GEN_UN_NEGO, 			( 				SELECT GEN.VAL_OID, GEN.VAL_I18N 				FROM V_GEN_I18N_SICC GEN 				WHERE GEN.ATTR_ENTI = 'MAE_PRODU' 					  AND GEN.IDIO_OID_IDIO =  1  			) GEN_PRODU, 			( 				SELECT GEN.VAL_OID, GEN.VAL_I18N 				FROM V_GEN_I18N_SICC GEN 				WHERE GEN.ATTR_ENTI = 'REC_TIPOS_OPERA' 					  AND GEN.IDIO_OID_IDIO =  1 							 			) GEN_T_OP	 	  		WHERE POD.PROD_OID_PROD = MP.OID_PROD 			 AND LOR.MAFA_OID_MATR_FACT = PMF.OID_MATR_FACT 			  AND PMF.OFDE_OID_DETA_OFER = POD.OID_DETA_OFER 			  AND LOR.PROD_OID_PROD = MP.OID_PROD 			  AND PER.FEC_INIC >= PER_INI.FEC_INIC 			  AND PER.FEC_FINA  < = PER_FIN.FEC_FINA 			  AND PER.OID_PERI = RCR.PERD_OID_PERI_RECL 			  AND ROR.CARE_OID_CABE_RECL = RCR.OID_CABE_RECL 			  AND ROR.TIOP_OID_TIPO_OPER = RTO.OID_TIPO_OPER 			  AND RTO.ROPE_OID_OPER = RO.OID_OPER 			  AND PC.OID_CATA(+) = POD.OCAT_OID_CATAL 			  AND LOR.OPRE_OID_OPER_RECL = ROR.OID_OPER_RECL 			  AND RO.OID_OPER = GEN_OP.VAL_OID(+) 			  AND MP.UNEG_OID_UNID_NEGO = GEN_UN_NEGO.VAL_OID(+) 			  AND MP.OID_PROD = GEN_PRODU.VAL_OID(+) 			  AND RTO.OID_TIPO_OPER = GEN_T_OP.VAL_OID(+) 		     	 AND MP.UNEG_OID_UNID_NEGO IN ( 1 )    			  AND RCR.PAIS_OID_PAIS =  1 	 	 			  AND PER.MARC_OID_MARC = 1  			  AND PER.CANA_OID_CANA =  1  		      AND RO.OID_OPER =  32  		 	 	  AND PC.OID_CATA IN ( 1 )					  		GROUP BY SOCI.SOCIEDAD, 			   GEN_OP.VAL_I18N, 			   PER.VAL_NOMB_PERI, 			   GEN_UN_NEGO.VAL_I18N, 			   MP.COD_SAP, 			   GEN_PRODU.VAL_I18N, 		   	   GEN_T_OP.VAL_I18N 	) ) WHERE CONTROL  < =  23   